import { createClient } from '@supabase/supabase-js';
import { type NextRequest, NextResponse } from 'next/server';

import { Database } from '@/utils/database.types';
import { airdropNft } from '@/utils/walletapi';

const ALLOW_LIST_ADDRESSES = [
    '0xEd981764D7fbe86F9f3bfA5b7841C12005A378DC',
    '0xD2990F9DCCe40958e7c57E4FdE58E89B7b2B3035',
    '0x67FF6d34F70aF2d2C0C49b834917c1cb67A5CA7a',
    '0xAbbf0cf375E6314bd606d391059410CBd8bC5A9A',
    '0xB1d1dE7bF93192737c5BF1ED6bb4cfbBdbE4B17a',
    '0x3E1B100EE96dB65bdd7Afb03b35DcD1C2F6088AA',
    '0x29891F95d64b7a30d8aB42256523d12051194f2b',
    '0x8668B2862556fEe9D4aF6d89A8810347E0326B1f',
    '0x4a738fF4dfEBF7Af169922Bb3b0d2e93f5E425a8',
    '0xb74f39125686dAb978259aC955f2Cf27D2079CD2',
    '0x645251b3547C21327E7C06368C9370ec60e87C91',
    '0x0d0a980aBE7DA5a50A70a7E55a6d731818A4826E',
    '0xB9538024fccB33349F200575f720B9B3b9e68e43',
    '0x66563F42CE77fCf4Ba7907E02135b6ef88842CD7',
    '0xdAa9bbd112201fF5014979ED901c5976cB3aa6F8',
    '0x8CCa7B560d3F0F9DCe4482381084Ce258f1cBbB9',
    '0xE30eDFA9A14e715CD9DEB7f2647d4cD3Dbd41cd8',
    '0x292007B27Cb38Fb6bBa2f24800AF1151CbF2cb93',
    '0x36F7C58E87C9adf4F28F86AF97Dc7dF2b784d87A',
    '0xD7b4d9333A0205df14EAa12DF9DD1910de671782',
    '0x084eda490aAD1f57361A08926E2830e654aDe226',
    '0x71B18eF7fdF35De33e0c268bB374F7FfAA621979',
    '0x636A5E28f5c4d362c6C276A9462Dd80fF9077D4B',
    '0xeB7c97489297DB4250e97889AfaA7a17ef6FEC45',
    '0xdF8363CCB291C7E9a3e3782Daa41D6b6B0aa6B3E',
    '0xD5B82f1efef871C931128faaa4484d4861d1Cdd9',
    '0xfD432a6AC06E9851f31F2D96dbDC096BfA9bC7f7',
    '0x6a8DB4ec3367bBB20B29bDCfDEc7399a577d857A',
    '0xB1BefCaB3A0C571a486cD43A89fbEfDFf3b78204',
    '0x5DB102dB832B2BD7b48A4B43228AAD683CAa68DA',
    '0x19B5C7aD142472c7B7E7f0E6a6DBAAe4E27A9fec',
    '0x3116314c6e365731c378ecaaf0c8186063c4daa1',
    '0x657668345227257EB842e2088bE0B0Ad59DA191E',
    '0x442a3b32648A7DCecB69C53a21d679f099CB953E',
    '0xF35267fF8B6CB96da2d568E249C5861b4f697c5f',
    '0x6049f8F6FEA459B3491E5c8e3EDf0a6142C79CFF',
    '0x284ed2Baec3e224cbA8A8dB2D53d470CfD731b65',
    '0x8a3fe7ecb239d38a7ffa5608afdb792d85bff090',
    '0x4B8680FbEEF83d7E87129Ae7A60fcebE31b1b19E',
    '0x09fdBb42b31E4E98e54B036aE10eC067486950ca',
    '0x03583af8Bd2474143958bB640b13E292666C8B26',
    '0x23Dd488AEf70eE46E09f14c209B8A83653e3F1E8',
    '0x980f0A2F91DE1026B85bF3E068BCd487De61CE17',
    '0xC53Cd72694C0eDc52a48d915FacDea5449aC7C92',
    '0xc6e760e968ac1c497d845760D64d1FC99ed75F72',
    '0x89d2BF03c96d40c9af3A3359a93922FEF697B1d0',
    '0xc838b78A5f9940aFc61663baDbBe0f120E3294C3',
    '0x0a0eb41c51Adc63aA76AbD5fbbdbf94bECc6c428',
    '0x7D70e83457A1357257065Ba8F25f5F7d6dC618c3',
    '0x016562aA41A8697720ce0943F003141f5dEAe006',
    '0x755e299337B0E2A81Ae2ba86C997B8952E37fdC8',
    '0x2C44D076ac48bF4b394E013A55f40052a1730BE4',
    '0xf9964De4cc15A78496EC52890ace9Ae98CF957f3',
    '0x656E08Efe4Fb1433781FFdCA8411458fFd8575C1',
    '0xf9cE9E435EBAD01801E8Af0400E546b9653ADc23',
    '0x9945Ba0a781200B90b4c28528cced309aBB90871',
    '0x11Ee52De6f6321382E48D9d4324703c9C139Fa6a',
    '0xd24ab99c0a0553730300b61b615ba0aa97d7a279',
    '0xC50D80eE9fa7B79276c8106f98009327C2d7A698',
    '0xD5D010899872926804cF723cdfd729A7053981D8',
    '0x15f79d5ce0fa672d27aab2d0f699f3153e7aa66e',
    '0x842c55D4C995C35f10e22Bb1f71F0273Cd936Be6',
    '0x465FffEAe2487E684439D1722dE612f388dD28DD',
    '0x0fCF5f9Cd6Cf923941A4d359Fc58375A4D307daD',
    '0x82de6b9be0e2ece19d3d90028213c8500cb73b75',
    '0xbcD8608A086Fc754336915FCe1858B4C2Ff7327E',
    '0x2Da58f7bce847755f9d6686350B95B0dac99F446',
    '0x5C30F1273158318D3DC8FFCf991421f69fD3B77d',
    '0xE163527E9D127a5668b841ac2434D159D39d0164',
    '0xe445939A455950134EC35c3FCb2F704afEFee0E3',
    '0x564b9A791b39024952DD5d7951C0E90Be692F485',
    '0x7641779D2A20E222e0CB463290F8dA7E57a513EC',
    '0x7a9c70d35f85028f365d579F036626c26C2ec5eB',
    '0x3A6292c3F4Bb9dE163fF32848d15698cB4E18ABE',
    '0xa087bd1613c1853A69e98bc8B35A038A04eA8154',
    '0xd21E22Bd3912713790d38eC1AF558a864B8e86C7',
    '0xA502De16dEa99aCA87BEE4265ad8Fb0D9655BBe5',
    '0x09b419496bb8470c1423655eEB3Ad08894F1E697',
    '0x0a7F4bDA87ECA517da302d4EeF6571439403Cb4C',
    '0x90033A3dC816399d0dcf90BD45b3E733714d14e1',
    '0x4a34F1c5BAA5184682a57E91A8dC9Fe110c38908',
    '0xEbb862a98F4c38Bc228Cb9336cDE1877CE2E39a4',
    '0x7B504e6e22a6fAB959eB6089afaF235FcE0968aA',
    '0xbD9f889b903656d6a11877FF0Bf068f86898a981',
    '0x125E54c99Bed45565AA8d62A927f8c284E51F9Bd',
    '0x78F0914385714666Aa4A6b28B929F2a27225FC8F',
    '0xb1235aaa40cff6e5FF010e5575adfd18c794a090',
    '0xcC2cB1Eeb635ADdb275930B552c475D86036ED18',
    '0xf3876f46d3378375Af313F22491904C2f1d9d6DD',
    '0x554e0226C7560B51f420F6b1f4Dd41d63B588b76',
    '0xF083259356dfD11CbA33C66a94D5db20ce7365e9',
    '0x2aFDd8f00bb4cD29598C1930560067B70D2Cf5F1',
    '0x7B46fc723641FE99fFDD22e555623cf84F8067c7',
    '0x36D90e0a80f776e5b6812Fa5457466a396D53165',
    '0xF04223482Ae95344A5Ce355a8c4c6a36f13d1C35',
    '0x40655e1Fef450362e680de271232B9f6011072A6',
    '0x30BC0Cd6Becf2203C701618d7A84B23557971723',
    '0x74d73025F622777374E036dc28F242F7eBDeAE07',
    '0xF478059f0Ac3ffdbA3E5780764f9e9d77990CdC7',
    '0x85B852ad93C1428052d33e3343327e65690cea2f',
    '0x2f3bb80a7fdd39ff56493e678f452a379e73a9e0',
    '0x77B68765ec6Af9e4cB0e8fE450df7382cc5ab7Cc',
    '0x9F17B4b2831A308DAaD43eDe95FAdE0791165fF8',
    '0xd8F414789D6Ce985FfE6664E757B9147eA1243F3',
    '0x096F0f5d02CD18E615Bc39528fdC3A0fBf95A645',
    '0x79227EB2001E1E59CC5374c9f14761568E6808e7',
    '0x9C94206715821868C476d9e94D061dcE325170a6',
    '0x32b65736740530FEEE8C35F0b7200723982CaEAC',
    '0x22a88eed65C7B021fFD1b6a51E8679C7BA31504B',
    '0x157A8C71BCF264d81a87E055422E8D29eCd0aD93',
    '0xcCFE24467853B04640299dD381450dFFF317C626',
    '0x73Ccb5636b2410D0d87Fd2ae0452566f05319725',
    '0x5eefd4CaeB7fB4E0436003aA0757bf7e9eb159de',
    '0x183576421bCdB161886a54601B85C89ACCE0e763',
    '0x1681E7a1E8092bcb1452b5bF4b64aD39cdf3bfEf',
    '0xa0Ff8A5C2BDE9F610b5CBf0eD934A8B9661A89A6',
    '0x268BFd8E7449d586607DC350638ce93e0e9ab9e3',
    '0x11063aaD50a7d03Ba4Ddb10302FBA98abFDc9475',
    '0x53dF409fE3802387A82dCc3c4b1FFB34CB60101a',
    '0xC06F632E48BE56993fDc0717F83a1af9e1f48503',
    '0x06E03D78d6D6f712dF921a39A80869753FEC1e36',
    '0x3f5B21f351B37fd4075A9fAaAb37Fa3bCf2e3666',
    '0x1b35eBb9F4EA6E40DcC628F612A1f6f06634443b',
    '0x95b5a610A54ec14f8BbCa32f2869A32B34BE7272',
    '0x83924DA2f9e081e39bE3eB74D43525C4A80B7aB4',
    '0xF06FdE3f951a5a9d0c3A8A3384a78e0bBbfC8Af7',
    '0xe72154b6d760A7EA6756c6b148fCc5f10C8B0F35',
    '0x3a248DD467a508EEc691b8Cfcf65E160C8Aca7f5',
    '0x3Df55EC926c7dE9307150023380872F406993834',
    '0x02C99c3796A00fE93D99846aB0Eb521a68945De8',
    '0xe557164558AdF7317815B036b1577297AB3E6e30',
    '0x76A21ec9485246Fba9A0DCEd230F74fDD90C15Ac',
    '0x3e2E6134F72ba1Fbb48fD5a840B11de9698E7B6D',
    '0x8272e0EFf1DDfbB9d3F65aa09164080D5BdC77bb',
    '0x7541B6fa58D92Ee66aBC942C7443e3173c819269',
    '0x6FeE22f9c3EE2A7C984bAADAC9EfA2FE074E01D3',
    '0x1A2d742cc0EA767982fb425E06511bEBe7D34590',
    '0x41A0A0A5f2B731C19B8C0E61e9e2D95facdd1089',
    '0x25D55bf92211714acc93e2Fa2E2d20BB210D6Fae',
    '0x2e99dBB3879Fb4950d24B9c2Cae64669f523C089',
    '0x3719689cFc23CbDD042b120A5A9D05a6D20F2a56',
    '0x9fCC25Ca31b3792d7e19a55ff08DE22285770815',
    '0xAD2f28046D37D9C96c4807D35950E29db35B847D',
    '0x85496e4699CaaD8FCcCE7eA94bdd09536E7E05c4',
    '0x18df861a834410a0f2031955f5E717F06E56249F',
    '0x1f686d95BdDd1959E49Fa279bFB75139d4e673A9',
    '0x7159DB3386E7D0b4c95d8667297917Fb6eC47697',
    '0xF7039DeD4eB72Badbfe29DBa646C758A2f79D3D0',
    '0xdBD4cDE1750da690dc6751658Cf0215a4fbed123',
    '0x774A39b8af1953817F9Da5D9E436Aa241592C7dD',
    '0x1E4B7862fd1c9aDB3E4FD5f902d5B2fD567a23C9',
    '0x7cfD5EC6759dFF05187220D5EfBF591769c58537',
    '0x988aa8A159408f66020b8c58A980DABa3991DFCb',
    '0x2E89ab04CC939f69bf751a33FB4FC8E9565caA1c',
    '0x94951247EEda7AC37FD5A202A4db29196C84035A',
    '0x6120cbe23338740C09E9DaA544146dbFBcaA6839',
    '0x9C59be418Bc76C12863618Ea271F0510E02D30F4',
    '0x8a5c84D17d8EAb45eF50eb6adfbC54C6c5962cb0',
    '0x71351a2542227E7145B8Dcac576E75D6C9Fe4E63',
    '0x90561d25E7cbbd34D6284776BC06570e19D9f8A5',
    '0xC89A1F3E158D8a497637a7bbB55a6FDF39EF453b',
    '0x2118dc645976CA838548eE03F8321B8DBA4d00a8',
    '0x6F5D979DC81c6448DF524435eD78deaC05FdBF6F',
    '0x95E4AbBce3fAD60b6D6EbC6CbCEad6E18E7Df16f',
    '0x80ae9942963FB929f730e88A96Cbb6064efe2c59',
    '0x524BdC41A95239027E2737BD509312695A6ADADB',
    '0x1036d7b7594c6310c33ED6A51d64d76127Fa26A2',
    '0xf6F7F1c3Ea94c8305D8179C2Cf0e06233daEd659',
    '0xE78a367a3C91C12Be896e4eb371eE4d909ca5FCd',
    '0xD0Ae05b06094c00CdFb8022Ec46a523Ff55fC22F',
    '0x2e32f82676F606B46604bd848c4E0F221ffFF18c',
    '0xf9Bf6Aa2155b6b372806c46e9Eb31b74915f360B',
    '0xa88d0d4d01d2ef5e89a1cabf952336a88468ad81',
    '0x15E5bE5D91184407425C420cbCf31C764F36419F',
    '0x468171D6D4c54B341A148050CeA641F7C96e1cF5',
    '0xDbd6bFfcD13AFB7A93AE6Fb1a88051268D0c6565',
    '0x4497056debd239DB3CEe25416849a798C4e9b3e0',
    '0x3e15A6dB46b868EC58556473b5c04eCC5EEf2FB1',
    '0x5D08AB99B63Cc740312d6E8E6382CF4155fDdA49',
    '0x33425257b937989c2b59d3A5AAAc0EDC382FB57D',
    '0xcbB6f95944362E5C8E3a07c76248244Df9791d81',
    '0x7F21Af02B88bc1D848437713EfF25a0E6b8925D7',
    '0xC80CcE18fF069bE9f13583bCBb08d3C66796d274',
    '0x2693855067e48737a76eed5f29356ba1f91e2a6f',
    '0x80a2cDe572E71A7E23AD9A227e2845BceC1A370A',
    '0x920a9D51c856A837B8de6E6e180735333C5EE613',
    '0xE33178f0157398e72930B9373161Dbd610c5a4F8',
    '0x1afa86885f52337E0A7E62b9cB121c9cbfd230c8',
    '0x22aE3Fe1e88355796fd69748EB7284F0C393FBEC',
    '0x294252667D7a0e0DDD888a807E4Fcf0D5841F203',
    '0xcbb5570ED977b33367E215428C4c2bEfED6136fB',
    '0x7678A68D63Ce8dd2a7DFD595123fCcB7069B9532',
    '0xEeA399B1AFA22c5a727eB9Be1A17Fde8f5374701',
    '0x8ac199ccb8287Ad45a475Cc8Be6CA32caB0760C4',
    '0xC740c180e627edBA3Ad10c465666cC2147f3D086',
    '0xafbc2a1ea36bbc341751063a35fb574e1c1c90cd',
    '0xd2809a8e38e4526e78d357cabc9b62a1da1c0160',
    '0x9a9382f57C7Db8dcc2c6f35b0587454B7B93260c',
    '0xdBE81144E16aDf50120a7EEF7688E88fD423E744',
    '0xffce41ef88f8ecbdca9890c43c69475d43ce489f',
    '0xd3E3Fe84a2B410496AdB64790D4C425e7F0D81Ab',
    '0x7f6A9376e08dff110FC9f72c8fF261A3124444B4',
    '0x2D79bbA54A9dEF87b1C8923b9E55091D2990F6EF',
    '0x56a2A3022d9cA454A79deCD8cD0c9d046858f8BC',
    '0xE2c420c10c4a9F68A3a6218002eFe90Fd6BC1a47',
    '0x9eC78A75048B52CDc72Be4AB14d6A3A849E4ea76',
    '0x774C9c30467C4478b8d9a528E8ee872AdA00149a',
    '0x36A25Ab4986F272201ad6Ad5Bb92Ee6318725AB4',
    '0x86c3854CbcF98c8932935d599A98d737C10d8DA2',
    '0xaaf5bCE070A579831900eda750d93E9D42b2a781',
    '0x2dDB16587EEEB9890268EcFef00ed8671AD8c5C5',
    '0x8c5bf0EDD1CF8Ca1806633f5359bfE65D1d21C15',
    '0xAcfAE012bbbB7e60A360558D50aF362cF70719BA',
    '0xBaFa59e3a8e85427f56032eed7Be050047ce4D16',
    '0x8FfAACDd97465EcAE85246Ed4a6Cc0CF7019d8ee',
    '0x77f3757dBA7c4f387d299C299a2eB418cc61DDD4',
    '0x1bA65B2fcB19B74B78d456FDD1CE9B1496fA6711',
    '0x1f387421cBE0DCDEeeC2880d0fe4EAbbA6603F34',
    '0x75B0b20959343d2dA9295251334AaDf834DEe3b3',
    '0xe96b4Cc1DC97DbCa6690c8eB0434181466d680e7',
    '0xd3F96d976a499A8d49D765250dA775E8E7eC7b69',
    '0xeFBF828e3779fc50E1d10f0D2EA97c0FE789Aa42',
    '0xca39063539e71e572f1d2762ebAa61C8DD6d07bC',
    '0xf607887544AfdCB7404391f63311Aa8BFeC40FCD',
    '0xb7C527c9C21269349835d736582ac5A9f704b647',
    '0x21A1E56a4E35B2abFcd92bAd52012b47C00a147f',
    '0xF60cAC0a23cC3A0c42Cfc7c431Ab773931698f87',
    '0x55965974232d30f5200dcc39715dbbb7826b5591',
    '0x808b5E91C921Dd78bB1320DC2D4151f24E4Bc4c9',
    '0x9F17B4b2831A308DAaD43eDe95FAdE0791165fF8',
    '0x7D49B559491394b92C967505FA98EE71105d7B6a',
    '0xfeE51815a90AeC4741EEC3816960693700BeefB1',
    '0xB0cBAb033d6E273482e73eecC3DaCCb07ee15Abd',
    '0xcDaD2F1Bca130C0982b643B87BBee5F00Db1d872',
    '0xebD641d1fF87AA1D349c37d73DFC7F2f52d8A2C5',
    '0x75bF689994A178B562301f07fc83aAa9F9a70e80',
    '0x82cC20C75b7DbBA37145b9c77F55ef99c5c235C4',
    '0x0b96dE666A9C6D03A5648f34B3C4cD4bEDcC7cd9',
    '0xE9dFACaAc9588A4cA466010aA2BCe0E97Ae792bc',
    '0x44Dccc316C891514A67e5A86fdc9cE70951712Cb',
    '0xc2D12f712dB52F59d1bB14F9A2B4028C7350cb34',
    '0x020Eb7F6E9540eAE2208fFd1DEb5D3940A3F57f1',
].map(addr => addr.toLowerCase());

const supabase = createClient<Database>(
  process.env.SUPABASE_URL as string,
  process.env.SUPABASE_SERVICE_KEY as string
);

export type MintData = {
  address: `0x${string}` | undefined;
  command: string;
};

export async function POST(request: NextRequest) {
  const body: MintData = await request.json();
  const { address, command } = body;

  const isAllowListAddress = address && ALLOW_LIST_ADDRESSES.includes(address.toLowerCase());

  const nonce = "__default_nonce__"

  if (!isAllowListAddress || !command) {
    return new Response(
      `Missing parameters: userAddress: ${address}, command: ${command}`,
      {
        status: 400,
      }
    );
  }
  try {
    await airdropNft(address, command, nonce);
  } catch (e) {
    console.error(e);
    return NextResponse.json({ success: false });
  }
  return NextResponse.json({ success: true });
}
